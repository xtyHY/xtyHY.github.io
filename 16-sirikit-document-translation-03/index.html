<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />




  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">










<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="最近在看SiriKit的官方文档，自啃 + Google翻译，如有错误或语义不当还望指出。  官方文档原文 - Resolving and Handling Intents  你的Intents扩展的入口是INExtension对象，INExtension对象的作用是引导Siri找到能够处理用户传入意图的对象。">
<meta name="keywords" content="iOS,SiriKit">
<meta property="og:type" content="article">
<meta property="og:title" content="SiriKit官方文档 - Part1-3 解决和处理意图">
<meta property="og:url" content="http://www.devhy.com/16-sirikit-document-translation-03/index.html">
<meta property="og:site_name" content="寰宇小仓库">
<meta property="og:description" content="最近在看SiriKit的官方文档，自啃 + Google翻译，如有错误或语义不当还望指出。  官方文档原文 - Resolving and Handling Intents  你的Intents扩展的入口是INExtension对象，INExtension对象的作用是引导Siri找到能够处理用户传入意图的对象。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://developer.apple.com/library/content/documentation/Intents/Conceptual/SiriIntegrationGuide/Art/resolve_confirm_handle_cycle_2x.png">
<meta property="og:updated_time" content="2017-02-28T08:03:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SiriKit官方文档 - Part1-3 解决和处理意图">
<meta name="twitter:description" content="最近在看SiriKit的官方文档，自啃 + Google翻译，如有错误或语义不当还望指出。  官方文档原文 - Resolving and Handling Intents  你的Intents扩展的入口是INExtension对象，INExtension对象的作用是引导Siri找到能够处理用户传入意图的对象。">
<meta name="twitter:image" content="https://developer.apple.com/library/content/documentation/Intents/Conceptual/SiriIntegrationGuide/Art/resolve_confirm_handle_cycle_2x.png">



  <link rel="alternate" href="/atom.xml" title="寰宇小仓库" type="application/atom+xml" />




  <link rel="canonical" href="http://www.devhy.com/16-sirikit-document-translation-03/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>SiriKit官方文档 - Part1-3 解决和处理意图 | 寰宇小仓库</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">寰宇小仓库</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Coding Life</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.devhy.com/16-sirikit-document-translation-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="寰宇">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="寰宇小仓库">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">SiriKit官方文档 - Part1-3 解决和处理意图
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-10-31 23:58:15" itemprop="dateCreated datePublished" datetime="2016-10-31T23:58:15+08:00">2016-10-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-02-28 16:03:17" itemprop="dateModified" datetime="2017-02-28T16:03:17+08:00">2017-02-28</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS开发/" itemprop="url" rel="index"><span itemprop="name">iOS开发</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/16-sirikit-document-translation-03/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="16-sirikit-document-translation-03/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>最近在看SiriKit的官方文档，自啃 + Google翻译，如有错误或语义不当还望指出。</p>
<blockquote>
<p><a href="https://developer.apple.com/library/content/documentation/Intents/Conceptual/SiriIntegrationGuide/ResolvingandHandlingIntents.html" target="_blank" rel="noopener">官方文档原文 - Resolving and Handling Intents</a></p>
</blockquote>
<p>你的Intents扩展的入口是<a href="https://developer.apple.com/reference/intents/inextension" target="_blank" rel="noopener">INExtension</a>对象，INExtension对象的作用是引导Siri找到能够处理用户传入意图的对象。</p>
<a id="more"></a>
<p>在你的扩展中，你经常使用以下三种类型的对象来处理意图：</p>
<ol>
<li>一种意图对象，其包含Siri从用户收集的数据。</li>
<li>一种处理对象，其实用于解析、确认和处理意图的自定义对象。</li>
<li>一种响应对象，其包含对意图的响应。</li>
</ol>
<p>当SiriKit有一个意图对象需要你的App处理时，它会要求你的<a href="https://developer.apple.com/reference/intents/inextension" target="_blank" rel="noopener">INExtension</a>对象提供一个能够处理意图的处理对象。处理对象对他们处理的意图采用特定协议。处理协议都是相同的结构（具有解析、确认和处理特定意图的方法）。</p>
<p>当实现处理程序(handler)时，你必须实现用于处理意图的方法。虽然所有其他方法是可选的，但建议实现其中一些。在你尝试处理一个意图之前，请使用解析和确认意图的方法来验证此意图的内容。在验证过程中，Siri会根据需要与用户进行交互，以便收集你所需的附加信息。</p>
<p>图3-1展示了SiriKit与一个处理对象之间的高阶流程。当用户发起与你的App相关的请求时，SiriKit会创建一个相应的意图对象。如果意图有需要解析的参数，SiriKit需要你的处理程序(handler)单独解析这些参数。当所有参数被解决时，SiriKit向你确认你是否准备好处理该意图。如果你表明你已经准备好了，SiriKit会让你去处理这个意图。此时，你执行由意图表示的任务。</p>
<p><img src="https://developer.apple.com/library/content/documentation/Intents/Conceptual/SiriIntegrationGuide/Art/resolve_confirm_handle_cycle_2x.png" alt="图3-1 处理打车请求意图"></p>
<p>有关用于实现意图、响应和处理对象的类和协议的列表，参阅<a href="http://devhy.com/2016/11/03/19-sirikit-document-translation-06/" target="_blank" rel="noopener">意图域</a>。</p>
<h1 id="向处理对象发送意图"><a href="#向处理对象发送意图" class="headerlink" title="向处理对象发送意图"></a>向处理对象发送意图</h1><p>当一个意图到了你的App，SiriKit需要你的Intents扩展为该意图提供一个处理对象。说具体点就是SiriKit调用你的INExtension子类的<code>handlerForIntent:</code>方法，这是你的扩展的入口。你从此方法返回一个SiriKit用于解析、确认和处理意图的对象。</p>
<p>代码3-1展示了一个<code>handlerForIntent:</code>方法的实现，该方法为消息和VoIP电话域中的Intents提供了处理对象。不管你处理哪个意图这个方法的结构都是相同的。你检查传入意图的类，并返回一个能够处理该意图的处理对象。你可以用一个单一的处理对象来处理你所有支持的意图，或者为每个意图创建不同的处理对象。在该示例中，Intents扩展为所有与消息相关的意图返回相同的处理对象，并为音频和视频电话意图返回不同的处理对象。</p>
<p>代码3-1返回意图的处理对象</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>) handlerForIntent:(INIntent*)intent &#123;</span><br><span class="line">    <span class="keyword">id</span> handler = <span class="literal">nil</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ([intent isKindOfClass:[INSendMessageIntent <span class="keyword">class</span>]] ||</span><br><span class="line">        [intent isKindOfClass:[INSearchForMessagesIntent <span class="keyword">class</span>]] ||</span><br><span class="line">        [intent isKindOfClass:[INSetMessageAttributeIntent <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        handler = [[MyMessageHandler alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([intent isKindOfClass:[INStartAudioCallIntent <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        handler = [[MyAudioCallHandler alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ([intent isKindOfClass:[INStartVideoCallIntent <span class="keyword">class</span>]]) &#123;</span><br><span class="line">        handler = [[MyAudioCallHandler alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(<span class="keyword">for</span> intent: INIntent)</span></span> -&gt; <span class="type">Any</span>? &#123;</span><br><span class="line">    <span class="keyword">var</span> handler = <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> intent <span class="keyword">is</span> <span class="type">INSendMessageIntent</span> ||</span><br><span class="line">        intent <span class="keyword">is</span> <span class="type">INSearchForMessagesIntent</span> ||</span><br><span class="line">        intent <span class="keyword">is</span> <span class="type">INSetMessageAttributeIntent</span> &#123;</span><br><span class="line">        handler = <span class="type">MyMessageHandler</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> intent <span class="keyword">is</span> <span class="type">INStartAudioCallIntent</span> &#123;</span><br><span class="line">        handler = <span class="type">MyAudioCallHandler</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> intent <span class="keyword">is</span> <span class="type">INStartVideoCallIntent</span> &#123;</span><br><span class="line">        handler = <span class="type">MyVideoCallHandler</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> handler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为你的Intents扩展是按需启动的，你的INExtension子类和处理对象应该尽可能少地保持状态信息。 SiriKit通常需要你在处理单个意图的期间多次提供一个处理对象。可能需要一些时间来解析意图的所有参数，尤其是如果Siri必须需要用户提供清晰的参数或附加信息的时候。每次请求一个新的处理对象能保证对象总是有效的。这也意味着你的处理方法不应该依赖于缓存的状态信息。相反，他们应该始终对任何所需的数据执行新请求。</p>
<p>有关如何实现此方法的信息，参阅<a href="https://developer.apple.com/reference/intents/inintenthandlerproviding" target="_blank" rel="noopener">INIntentHandlerProviding Protocol Reference</a>。</p>
<h1 id="解析意图参数"><a href="#解析意图参数" class="headerlink" title="解析意图参数"></a>解析意图参数</h1><p>解析阶段是你验证意图的参数的好时机，你也可以确保你有继续下一步需要的信息。由于源于Siri的请求是语音命令，用户所提供的初始信息可能是不完整或不明确的。在解析阶段，你可以检查每个参数并告诉Siri它所提供的值是否符合，或者是否需要Siri进一步询问用户的一些问题。</p>
<p>大多数意图会提供至少有一个参数给你的处理对象来解析。当实现你的处理程序时，建议你实现给定意图的所有解析方法。即使你不使用给定的参数，也可以使用相应的解析方法告诉SiriKit你不使用这个参数。告诉SiriKit你不使用参数可以阻止它向用户询问关于参数的任何问题。</p>
<p>你编写的每个解析方法的结构应该是相同的：</p>
<ol>
<li>从意图对象获取参数值。</li>
<li>验证参数值，并将其与你的App使用的数据进行匹配。</li>
<li>实例化相应能解析意图的<a href="https://developer.apple.com/reference/intents/inintentresolutionresult" target="_blank" rel="noopener">INIntentResolutionResult</a>子类。</li>
<li>使用你的解析结果对象执行提供的成功回调block。</li>
</ol>
<p>Intents框架为每个可以用作参数的数据类型定义了<a href="https://developer.apple.com/reference/intents/inintentresolutionresult" target="_blank" rel="noopener">INIntentResolutionResult</a>子类。每个子类包含类方法，用于指定是成功解析数据还是需要更多信息。父类<a href="https://developer.apple.com/reference/intents/inintentresolutionresult" target="_blank" rel="noopener">INIntentResolutionResult</a>还包含用于常用解析结果的方法。表3-1列出了可能的解析以及何时你可能使用。</p>
<p>表3-1解析意图参数时的可能结果</p>
<table>
<thead>
<tr>
<th>解析类型</th>
<th>样例</th>
</tr>
</thead>
<tbody>
<tr>
<td>你已成功匹配参数值</td>
<td>如果可以使用提供的参数值来处理意图。<br>你应该尽力获得的参数进行匹配解析，即使这意味着有根据的猜测用户的意思。<br>例如，如果用户为某个人指定了名称“John”，且该名称只有一个联系人，则可以将该参数成功解析为该联系人。<br>有关用于成功匹配参数值的方法的名称，参阅相应解析方案结果对象的文档。</td>
</tr>
<tr>
<td>不需要参数值</td>
<td>当不需要参数的值来处理意图时。<br>例如，当意图包含打开锻炼的目标（通常没有目标）时，你可能返回此解析类型。<br>使用<a href="https://developer.apple.com/reference/intents/inintentresolutionresult/1902445-notrequired" target="_blank" rel="noopener">notRequired</a>类方法创建你的解析结果对象。</td>
</tr>
<tr>
<td>需要消除歧义参数值</td>
<td>当你识别两个或更多可能的参数值，并且不能确定地选择一个参数值时。<br>此结果可能导致与用户的额外交互，以选择所提供的值之一。<br>有关用于消除结果歧义的方法的名称，参阅相应解析方案结果对象的文档。</td>
</tr>
<tr>
<td>该值需要用户确认</td>
<td>当你希望用户确认你选择的值时。<br>在你识别到一个参数值，但是你不确定这个值是否是正确的值时使用该结果<br>例如，当你选择的值与用户提供的值不同时，你可能会使用此结果，但你认为你选择的值是用户想要的值。<br>Siri总会需要用户确认某些类型的意图的值，比如涉及金融交易的意图。<br>有关需要用户确认的方法的名称，参阅相应解析方案结果对象的文档。</td>
</tr>
<tr>
<td>需要一个值</td>
<td>当缺少你需要的参数的值时。<br>例如，如果用户向其他人请求付款，但未指定付款金额，可以返回此结果。<br>使用<a href="https://developer.apple.com/reference/intents/inintentresolutionresult/1902446-needsvalue" target="_blank" rel="noopener">needsValue</a>类方法创建你的解析结果对象。</td>
</tr>
<tr>
<td>不支持该值</td>
<td>如果你的应用不支持某个特定值，或该值与其他参数的值冲突，可以指定此解析。<br>例如，当用户想要以瑞士法郎进行付款时，但你的App需要以欧元或美元进行交易，你可能会返回此解析。<br>使用<a href="https://developer.apple.com/reference/intents/inintentresolutionresult/2138302-unsupported" target="_blank" rel="noopener">unsupported</a>类方法来创建解析结果对象。</td>
</tr>
</tbody>
</table>
<p>在解析参数时，尽可能快地达到成功的解析。请求更多信息会导致额外的用户交互和处理程序额外的调用，这会导致延迟，也可能使用户感到不适。建议尝试基于用户的固有模式和习惯选择合理的值，并且仅在需要时要求消除歧义或确认。</p>
<p>代码3-2展示了一个乘车预订App用于验证乘车的下车位置的示例。如果用户提供了一个下车位置且其位于App的服务区内，则该方法返回成功的结果。如果值在App的服务区域之外，该方法可以让SiriKit知道该值不受支持。如果未提供值，则方法会要求用户提供值。</p>
<p>代码3-2解析意图的必需参数</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)resolveDropOffLocationForRequestRide:(INRequestRideIntent *)intent</span><br><span class="line">       withCompletion:(<span class="keyword">void</span> (^)(INPlacemarkResolutionResult *resolutionResult))completion &#123;</span><br><span class="line">   <span class="built_in">CLPlacemark</span>* location = intent.dropOffLocation;</span><br><span class="line">   INPlacemarkResolutionResult* result = <span class="literal">nil</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">if</span> (location) &#123;</span><br><span class="line">      <span class="keyword">if</span> ([<span class="keyword">self</span> locationIsInsideServiceArea:location])</span><br><span class="line">         result = [INPlacemarkResolutionResult successWithResolvedPlacemark:location];</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         result = [INPlacemarkResolutionResult unsupported];</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> &#123;</span><br><span class="line">      result = [INPlacemarkResolutionResult needsValue];</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   completion(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resolveDropOffLocation</span><span class="params">(forRequestRide intent: INRequestRideIntent,</span></span></span><br><span class="line"><span class="function"><span class="params">                            with completion: <span class="params">(INPlacemarkResolutionResult)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> location = intent.dropOffLocation</span><br><span class="line">    <span class="keyword">var</span> result : <span class="type">INPlacemarkResolutionResult</span> = <span class="literal">nil</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> location != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.locationIsInsideServiceArea(location) &#123;</span><br><span class="line">            result = <span class="type">INPlacemarkResolutionResult</span>.successWithResolvedValue(location)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            result = <span class="type">INPlacemarkResolutionResult</span>.unsupported()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        result = <span class="type">INPlacemarkResolutionResult</span>.needsValue()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    completion(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="确认请求"><a href="#确认请求" class="headerlink" title="确认请求"></a>确认请求</h1><p>使用意图的确认(confirm)阶段来执行任何意图参数的最终验证，并验证你是否已准备好处理意图。SiriKit需要你在所有参数都解析符合后才能确认意图。你可以使用确认方法执行一次最终检查。如果你的应用程序依赖于基于网络的服务，你还可以使用确认方法验证这些服务是否可用。虽然确认方法不是必须实现的，但是强烈建议去实现。</p>
<p>在确认方法中，执行任何确认任务，然后用你在处理意图时需要使用的数据去创建响应对象。如果提示用户确认，Siri将在确认界面中显示响应对象的详细信息。Siri总是提示用户确认重要的请求，特别是那些不可撤销或涉及金融交易的请求。在其他情况下可能不会提示用户。</p>
<p>代码3-3展示了一个简单确认开始锻炼方法。此方法提供一个响应对象表示App已准备好开始锻炼。此方法会将用户活动对象置为nil，这将导致SiriKit创建默认用户活动对象。</p>
<p>代码3-3确认锻炼的开始</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)confirmStartWorkout:(INStartWorkoutIntent *)startWorkoutIntent</span><br><span class="line">                 completion:(<span class="keyword">void</span> (^)(INStartWorkoutIntentResponse * _Nonnull))completion &#123;</span><br><span class="line">   <span class="comment">// 确认App已经准备好了</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 提供响应</span></span><br><span class="line">   INStartWorkoutIntentResponse* response = [[INStartWorkoutIntentResponse alloc] initWithCode:INStartWorkoutIntentResponseCodeReady userActivity:<span class="literal">nil</span>];</span><br><span class="line"> </span><br><span class="line">   completion(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">confirmStartWorkout</span><span class="params">(startWorkout intent: INStartWorkoutIntent,</span></span></span><br><span class="line"><span class="function"><span class="params">                         completion: <span class="params">(INStartWorkoutIntentResponse)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">   <span class="comment">// 确认App已经准备好了</span></span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 提供响应</span></span><br><span class="line">    <span class="keyword">let</span> response = <span class="type">INStartWorkoutIntentResponse</span>(code: .ready, userActivity: <span class="literal">nil</span>)</span><br><span class="line">    completion(response)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="处理请求"><a href="#处理请求" class="headerlink" title="处理请求"></a>处理请求</h1><p>处理意图的最后阶段是执行与该意图相关联的任务。你的处理对象的处理方法有两个职责：</p>
<ol>
<li>执行与意图关联的任务。</li>
<li>返回一个响应对象，其中包含你的App执行操作的详细信息。</li>
</ol>
<p>你如何处理意图取决于意图本身。如果可以的话，直接从你的Intents扩展处理一个意图。然而，一些意图需要回到你的App进行一些流程操作。例如，成功处理开始锻炼意图需要启动你的App以开始锻炼。对于其他意图，则执行任务所需的任何步骤。执行任务后，将你执行操作的详细信息放入返回到SiriKit的响应对象中。</p>
<p>代码3-4展示了处理开始新锻炼的方法。在这种情况下，处理程序会告诉Siri启动相关App来开始锻炼。其他意图可能需要使用响应对象提供附加数据。</p>
<p>代码3-4处理开始锻炼</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)handleStartWorkout:(INStartWorkoutIntent *)startWorkoutIntent</span><br><span class="line">                completion:(<span class="keyword">void</span> (^) (INStartWorkoutIntentResponse * _Nonnull))completion &#123;</span><br><span class="line">   INStartWorkoutIntentResponse* response = [[INStartWorkoutIntentResponse alloc] initWithCode:INStartWorkoutIntentResponseCodeContinueInApp userActivity:<span class="literal">nil</span>];</span><br><span class="line"> </span><br><span class="line">   completion(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleStartWorkout</span><span class="params">(startWorkout intent: INStartWorkoutIntent,</span></span></span><br><span class="line"><span class="function"><span class="params">                        completion: <span class="params">(INStartWorkoutIntentResponse)</span></span></span> -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="type">INStartWorkoutIntentResponse</span>(code: .continueInApp, userActivity: <span class="literal">nil</span>)</span><br><span class="line">    </span><br><span class="line">    completion(response)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每个响应对象都支持一个可选的<a href="https://developer.apple.com/reference/foundation/nsuseractivity" target="_blank" rel="noopener">NSUserActivity</a>对象，其中包含有关如何启动App的详细信息。如果不指定此对象，SiriKit会为你创建一个对象，并插入一个包含意图和你的响应的<a href="https://developer.apple.com/reference/intents/ininteraction" target="_blank" rel="noopener">INInteraction</a>对象。如果要提供其他信息，可以自己创建<code>NSUserActivity</code>对象，并向其<a href="https://developer.apple.com/reference/foundation/nsuseractivity/1411706-userinfo" target="_blank" rel="noopener">userInfo</a>字典中添加信息。</p>
<p>处理意图时所做的更改也应该反映在你的iOS应用界面中。作为执行任务的一部分，你的Intents扩展应将任何相关信息回传到其父iOS应用中。无论你在响应中提供<code>NSUserActivity</code>对象与否都要这样做。如果Intents扩展成功处理了意图，则可能永远不会传递用户活动对象。为确保更改信息被送达，请更新任何共享数据结构并可使用后台应用刷新、静默推送通知或其他技术将更改传回到iOS应用。</p>
<h1 id="处理意图的建议"><a href="#处理意图的建议" class="headerlink" title="处理意图的建议"></a>处理意图的建议</h1><p>在确认或处理方法中提供响应对象时，请考虑以下事项：</p>
<ol>
<li><strong>在响应对象中包含尽可能多的信息。</strong> Siri和Maps在确认或处理意图时向用户传达尽可能多的信息。使用详细的信息填充响应对象能清楚地传达你的App所做的事情，以创建更好的用户体验。</li>
<li><strong>将数据对象分配给响应对象之前，完全配置数据对象。</strong> 对于大多数响应对象，属性使用复制语义。如果你在属性中获取对象并对其进行修改，那么你所做的更改将在副本上进行而不是原始副本。因此，在进行更改后你必须再设置属性的值。</li>
<li><strong>尽快返回你的响应对象。</strong> 由于Siri和Maps在活跃地与用户进行沟通，因此请尽可能快地返回响应。如果返回响应需要超过几秒钟，请使用“正在进行”代码返回你的响应，以指示你仍在处理请求。</li>
</ol>
<p>适当的时候SiriKit会利用用户联系人数据库中的信息填写参数。如果你的App被拒绝访问用户的联系人，那么与这些联系人相关的信息可能不会包含在意图中。例如，意图中的任何<a href="https://developer.apple.com/reference/intents/inperson" target="_blank" rel="noopener">INPerson</a>对象可能只包含其<a href="https://developer.apple.com/reference/intents/inspeakable/2092306-spokenphrase" target="_blank" rel="noopener">spokenPhrase</a>属性中的值，并且不包含任何其他联系信息。这种缺乏访问权限还会阻止SiriKit访问联系人的地址，这导致一个短语，例如“我需要使用<app>乘车”导致意图没有下车位置。如果你的App被拒绝访问联系人，建议你提示用户允许访问联系人以获取更好的用户体验。</app></p>
<h1 id="SiriKit译文系列"><a href="#SiriKit译文系列" class="headerlink" title="SiriKit译文系列"></a>SiriKit译文系列</h1><blockquote>
<p><a href="http://devhy.com/2016/10/31/14-sirikit-document-translation-01/" target="_blank" rel="noopener">SiriKit官方文档 - Part1-1 SiriKit介绍</a><br><a href="http://devhy.com/2016/10/31/15-sirikit-document-translation-02/" target="_blank" rel="noopener">SiriKit官方文档 - Part1-2 创建一个Intents扩展</a><br><a href="http://devhy.com/2016/11/01/16-sirikit-document-translation-03/" target="_blank" rel="noopener">SiriKit官方文档 - Part1-3 解决和处理意图</a><br><a href="http://devhy.com/2016/11/02/17-sirikit-document-translation-04/" target="_blank" rel="noopener">SiriKit官方文档 - Part1-4 指定自定义词汇</a><br><a href="http://devhy.com/2016/11/03/18-sirikit-document-translation-05/" target="_blank" rel="noopener">SiriKit官方文档 - Part1-5 创建Intents UI扩展</a><br><a href="http://devhy.com/2016/11/05/19-sirikit-document-translation-06/" target="_blank" rel="noopener">SiriKit官方文档 - Part2-1 参考-意图域</a><br><a href="http://devhy.com/2016/11/07/20-sirikit-document-translation-07/" target="_blank" rel="noopener">SiriKit官方文档 - Part2-2 参考-App词汇文件格式</a></p>
</blockquote>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
            <a href="/tags/SiriKit/" rel="tag"># SiriKit</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/15-sirikit-document-translation-02/" rel="next" title="SiriKit官方文档 - Part1-2 创建一个Intents扩展">
                <i class="fa fa-chevron-left"></i> SiriKit官方文档 - Part1-2 创建一个Intents扩展
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/17-sirikit-document-translation-04/" rel="prev" title="SiriKit官方文档 - Part1-4 指定自定义词汇">
                SiriKit官方文档 - Part1-4 指定自定义词汇 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">寰宇</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">26</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">24</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/xtyHY" target="_blank" title="GitHub"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.aemiot.com/" title="Aem" target="_blank">Aem</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yitar.me/" title="Yitar" target="_blank">Yitar</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/cedric_jc/" title="Cedric JC" target="_blank">Cedric JC</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.csdn.net/u011427518/" title="瑾宇" target="_blank">瑾宇</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#向处理对象发送意图"><span class="nav-number">1.</span> <span class="nav-text">向处理对象发送意图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#解析意图参数"><span class="nav-number">2.</span> <span class="nav-text">解析意图参数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#确认请求"><span class="nav-number">3.</span> <span class="nav-text">确认请求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#处理请求"><span class="nav-number">4.</span> <span class="nav-text">处理请求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#处理意图的建议"><span class="nav-number">5.</span> <span class="nav-text">处理意图的建议</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SiriKit译文系列"><span class="nav-number">6.</span> <span class="nav-text">SiriKit译文系列</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">寰宇</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Pisces</a> v6.4.2</div>




        








  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1259942096&web_id=1259942096" language="JavaScript"></script>
  </div>



        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
      <div>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
<div class="addthis_inline_share_toolbox">
  <script type = "text/javascript" src = "//s7.addthis.com/js/300/addthis_widget.js#pubid=2137159" async = "async" ></script>
</div>

      </div>
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  

  
    <script id="dsq-count-scr" src="https://devhy.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://www.devhy.com/16-sirikit-document-translation-03/';
        this.page.identifier = '16-sirikit-document-translation-03/';
        this.page.title = 'SiriKit官方文档 - Part1-3 解决和处理意图';
        };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://devhy.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  












  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
